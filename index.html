<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>火山温泉バイオーム 食物網</title>
<script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
<style>
  body { margin: 0; font-family: sans-serif; }
  #toolbar { padding: 10px; background: #eee; }
  #cy { width: 100vw; height: calc(100vh - 50px); position: relative; }
  #overlay-icons {
    position: absolute;
    top: 0;
    left: 0;
    pointer-events: none;
  }
  .info-box {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #fff;
    padding: 10px;
    border-top: 1px solid #ccc;
    font-size: 14px;
    display: none;
  }
</style>
<svg style="display: none;">
  <symbol id="icon-nematode" viewBox="0 0 100 100">
    <circle cx="50" cy="50" r="40" fill="red"/>
  </symbol>
  <symbol id="icon-protozoa" viewBox="0 0 100 100">
    <ellipse cx="50" cy="50" rx="30" ry="40" fill="red"/>
  </symbol>
  <symbol id="icon-cladocera" viewBox="0 0 100 100">
    <path d="M30,30 H70 V70 H30 Z" fill="red"/>
  </symbol>
  <symbol id="icon-coccus" viewBox="0 0 100 100">
    <circle cx="50" cy="50" r="30" fill="red"/>
  </symbol>
  <symbol id="icon-yeast" viewBox="0 0 100 100">
  <path d="M 450 992 L 450 999 L 461 999 L 461 992 Z M 432 992 L 432 999 L 437 999 L 437 992 Z M 384 992 L 384 999 L 415 999 L 415 992 Z M 372 854 L 372 855 Z M 372 768 L 372 769 Z M 342 549 L 342 551 Z M 648 192 L 648 198 L 649 199 L 648 200 L 646 200 L 645 201 L 644 201 L 643 200 L 632 200 L 632 202 L 633 203 L 632 204 L 631 204 L 630 205 L 631 204 L 633 206 L 632 207 L 631 207 L 630 208 L 629 207 L 628 207 L 627 208 L 616 208 L 616 215 L 615 216 L 608 216 L 608 223 L 607 224 L 600 224 L 600 231 L 599 232 L 592 232 L 592 246 L 593 247 L 592 248 L 576 248 L 576 255 L 583 255 L 584 256 L 584 260 L 585 261 L 584 262 L 584 264 L 583 265 L 582 264 L 576 264 L 576 271 L 575 272 L 560 272 L 560 279 L 567 279 L 568 280 L 568 295 L 567 296 L 472 296 L 472 303 L 471 304 L 464 304 L 464 310 L 466 310 L 467 311 L 466 312 L 463 312 L 462 313 L 461 313 L 460 312 L 440 312 L 440 319 L 439 320 L 409 320 L 409 322 L 407 324 L 407 327 L 415 327 L 416 328 L 416 335 L 415 336 L 408 336 L 408 343 L 407 344 L 400 344 L 400 351 L 399 352 L 392 352 L 392 359 L 391 360 L 384 360 L 384 367 L 383 368 L 376 368 L 376 383 L 375 384 L 368 384 L 368 391 L 367 392 L 352 392 L 352 399 L 359 399 L 360 400 L 360 411 L 361 412 L 361 413 L 360 414 L 360 415 L 359 416 L 352 416 L 352 430 L 353 431 L 352 432 L 344 432 L 344 455 L 345 456 L 345 459 L 344 460 L 344 463 L 343 464 L 336 464 L 336 511 L 335 512 L 328 512 L 328 519 L 335 519 L 336 520 L 336 545 L 337 546 L 336 547 L 336 551 L 339 551 L 340 550 L 340 548 L 339 547 L 340 546 L 341 546 L 342 547 L 343 547 L 344 548 L 344 551 L 345 552 L 345 554 L 344 555 L 344 575 L 351 575 L 352 576 L 352 583 L 351 584 L 344 584 L 344 591 L 359 591 L 360 592 L 360 599 L 366 599 L 367 598 L 369 600 L 368 601 L 368 607 L 373 607 L 374 606 L 377 609 L 376 610 L 376 615 L 382 615 L 383 614 L 385 616 L 384 617 L 384 623 L 391 623 L 392 624 L 392 631 L 407 631 L 408 632 L 408 648 L 409 647 L 410 647 L 411 648 L 408 651 L 408 663 L 415 663 L 416 664 L 416 695 L 415 696 L 408 696 L 408 703 L 407 704 L 400 704 L 400 711 L 399 712 L 392 712 L 392 726 L 393 727 L 391 729 L 390 728 L 384 728 L 384 741 L 385 742 L 385 743 L 384 744 L 376 744 L 376 764 L 377 765 L 377 767 L 376 768 L 374 768 L 374 770 L 373 771 L 373 773 L 374 772 L 375 773 L 375 777 L 374 778 L 373 777 L 373 776 L 368 776 L 368 847 L 371 847 L 373 849 L 373 852 L 374 853 L 374 855 L 376 855 L 377 856 L 377 858 L 376 859 L 376 879 L 382 879 L 382 878 L 383 877 L 384 878 L 384 881 L 385 882 L 384 883 L 384 895 L 389 895 L 390 894 L 391 895 L 391 896 L 392 897 L 392 898 L 393 899 L 392 900 L 392 911 L 400 911 L 401 912 L 400 913 L 400 927 L 407 927 L 408 928 L 408 935 L 415 935 L 416 936 L 416 943 L 430 943 L 431 942 L 432 943 L 433 943 L 434 944 L 433 945 L 432 945 L 432 951 L 446 951 L 447 950 L 448 950 L 449 951 L 448 952 L 448 959 L 567 959 L 568 960 L 568 967 L 567 968 L 539 968 L 539 972 L 536 975 L 575 975 L 576 976 L 576 991 L 575 992 L 557 992 L 557 999 L 583 999 L 584 1000 L 584 1007 L 583 1008 L 368 1008 L 368 1015 L 372 1015 L 373 1016 L 372 1017 L 366 1017 L 365 1016 L 360 1016 L 359 1015 L 359 1008 L 336 1008 L 336 1013 L 338 1013 L 339 1014 L 339 1015 L 338 1016 L 331 1016 L 330 1017 L 327 1017 L 326 1016 L 304 1016 L 304 1022 L 305 1023 L 304 1024 L 302 1024 L 301 1025 L 300 1024 L 288 1024 L 288 1030 L 289 1031 L 288 1032 L 287 1032 L 286 1033 L 285 1032 L 272 1032 L 272 1039 L 271 1040 L 264 1040 L 264 1044 L 263 1045 L 264 1046 L 264 1047 L 263 1048 L 256 1048 L 256 1059 L 257 1060 L 256 1061 L 255 1061 L 254 1062 L 253 1062 L 252 1061 L 252 1060 L 252 1062 L 254 1062 L 255 1063 L 254 1064 L 248 1064 L 248 1074 L 249 1075 L 248 1076 L 248 1078 L 247 1079 L 247 1080 L 246 1081 L 245 1080 L 243 1080 L 242 1081 L 241 1080 L 240 1080 L 240 1081 L 241 1082 L 240 1083 L 240 1087 L 241 1088 L 240 1089 L 240 1102 L 241 1103 L 240 1104 L 240 1109 L 241 1110 L 240 1111 L 240 1112 L 241 1113 L 240 1114 L 240 1130 L 241 1131 L 240 1132 L 240 1135 L 246 1135 L 246 1133 L 247 1132 L 248 1133 L 248 1136 L 249 1137 L 248 1138 L 248 1144 L 249 1145 L 248 1146 L 248 1151 L 254 1151 L 255 1150 L 256 1151 L 256 1152 L 257 1153 L 256 1154 L 256 1167 L 263 1167 L 264 1168 L 264 1175 L 271 1175 L 272 1176 L 272 1183 L 285 1183 L 286 1182 L 288 1184 L 288 1191 L 290 1191 L 291 1190 L 292 1191 L 298 1191 L 299 1190 L 300 1190 L 301 1191 L 302 1191 L 303 1192 L 304 1192 L 305 1193 L 304 1194 L 304 1199 L 319 1199 L 320 1198 L 322 1198 L 323 1199 L 325 1199 L 326 1200 L 330 1200 L 331 1201 L 330 1202 L 328 1202 L 328 1209 L 327 1210 L 327 1215 L 431 1215 L 432 1216 L 432 1226 L 433 1227 L 433 1230 L 432 1231 L 432 1236 L 431 1237 L 431 1246 L 430 1247 L 429 1246 L 429 1240 L 424 1240 L 424 1279 L 429 1279 L 429 1274 L 430 1273 L 431 1274 L 431 1282 L 432 1283 L 432 1287 L 433 1288 L 433 1291 L 432 1292 L 432 1311 L 438 1311 L 438 1310 L 439 1309 L 440 1310 L 440 1311 L 441 1312 L 441 1313 L 440 1314 L 440 1327 L 447 1327 L 448 1328 L 448 1335 L 455 1335 L 456 1336 L 456 1343 L 468 1343 L 469 1342 L 470 1343 L 471 1343 L 472 1344 L 472 1351 L 535 1351 L 535 1345 L 534 1344 L 535 1343 L 536 1343 L 537 1342 L 538 1342 L 539 1343 L 543 1343 L 544 1344 L 544 1351 L 655 1351 L 655 1344 L 656 1343 L 662 1343 L 665 1346 L 664 1347 L 664 1351 L 669 1351 L 670 1350 L 672 1352 L 672 1359 L 679 1359 L 680 1360 L 680 1367 L 700 1367 L 701 1366 L 703 1366 L 704 1367 L 708 1367 L 709 1368 L 723 1368 L 724 1369 L 724 1370 L 723 1371 L 722 1370 L 713 1370 L 712 1371 L 712 1375 L 727 1375 L 727 1372 L 726 1371 L 727 1370 L 726 1370 L 725 1369 L 725 1368 L 726 1367 L 730 1367 L 731 1366 L 733 1366 L 734 1367 L 743 1367 L 743 1364 L 745 1362 L 747 1364 L 748 1363 L 750 1363 L 750 1362 L 749 1363 L 748 1363 L 747 1364 L 745 1362 L 746 1361 L 745 1360 L 747 1358 L 748 1359 L 753 1359 L 754 1358 L 755 1359 L 759 1359 L 759 1354 L 758 1354 L 757 1353 L 758 1352 L 759 1352 L 759 1347 L 758 1346 L 758 1345 L 759 1344 L 759 1343 L 758 1342 L 758 1340 L 759 1339 L 759 1336 L 760 1335 L 767 1335 L 767 1313 L 764 1313 L 763 1312 L 762 1313 L 761 1312 L 761 1315 L 760 1316 L 759 1315 L 759 1311 L 758 1310 L 758 1308 L 759 1307 L 759 1288 L 754 1288 L 753 1289 L 751 1287 L 751 1280 L 748 1280 L 747 1281 L 746 1280 L 745 1281 L 742 1278 L 743 1277 L 743 1272 L 739 1272 L 738 1273 L 735 1270 L 736 1269 L 735 1268 L 735 1256 L 736 1255 L 1023 1255 L 1023 1224 L 1000 1224 L 999 1223 L 999 1216 L 688 1216 L 687 1215 L 687 1208 L 688 1207 L 1023 1207 L 1023 1192 L 880 1192 L 879 1191 L 879 1184 L 880 1183 L 1023 1183 L 1023 1168 L 840 1168 L 839 1167 L 839 1160 L 840 1159 L 1023 1159 L 1023 1144 L 650 1144 L 649 1143 L 649 1136 L 650 1135 L 1023 1135 L 1023 1120 L 648 1120 L 647 1119 L 647 1112 L 648 1111 L 1023 1111 L 1023 1104 L 864 1104 L 863 1103 L 863 1096 L 648 1096 L 647 1095 L 647 1088 L 648 1087 L 1023 1087 L 1023 1072 L 704 1072 L 703 1071 L 703 1064 L 704 1063 L 1023 1063 L 1023 1048 L 728 1048 L 727 1047 L 727 1040 L 728 1039 L 1023 1039 L 1023 1024 L 800 1024 L 799 1023 L 799 1016 L 720 1016 L 719 1015 L 719 1010 L 718 1009 L 720 1007 L 935 1007 L 935 1000 L 744 1000 L 743 999 L 743 992 L 744 991 L 799 991 L 799 984 L 800 983 L 1023 983 L 1023 976 L 872 976 L 871 975 L 871 968 L 872 967 L 1023 967 L 1023 960 L 744 960 L 743 959 L 743 956 L 742 955 L 742 953 L 743 952 L 743 947 L 744 946 L 745 947 L 744 946 L 744 940 L 745 939 L 746 940 L 746 943 L 1023 943 L 1023 904 L 768 904 L 767 903 L 752 903 L 751 902 L 751 888 L 745 888 L 744 889 L 743 888 L 743 883 L 742 882 L 742 879 L 743 878 L 744 879 L 1023 879 L 1023 864 L 752 864 L 751 863 L 751 862 L 745 862 L 743 860 L 743 858 L 744 857 L 751 857 L 751 856 L 752 855 L 1023 855 L 1023 840 L 848 840 L 847 839 L 847 832 L 848 831 L 1023 831 L 1023 784 L 880 784 L 879 783 L 879 776 L 880 775 L 1023 775 L 1023 752 L 800 752 L 800 753 L 799 754 L 784 754 L 783 753 L 783 752 L 776 752 L 775 751 L 775 746 L 774 745 L 776 743 L 1023 743 L 1023 736 L 824 736 L 823 735 L 823 728 L 814 728 L 813 727 L 808 727 L 807 728 L 800 728 L 799 727 L 799 715 L 798 714 L 799 713 L 799 712 L 800 711 L 807 711 L 807 710 L 808 709 L 815 709 L 815 704 L 808 704 L 807 703 L 807 699 L 806 698 L 806 697 L 807 696 L 807 695 L 808 694 L 809 695 L 815 695 L 815 680 L 816 679 L 819 679 L 820 680 L 820 681 L 831 681 L 831 680 L 832 679 L 1023 679 L 1023 672 L 816 672 L 814 670 L 814 667 L 815 666 L 815 648 L 814 647 L 814 642 L 815 641 L 815 624 L 809 624 L 808 625 L 806 623 L 807 622 L 807 616 L 802 616 L 801 617 L 798 614 L 799 613 L 799 609 L 798 608 L 793 608 L 792 609 L 791 608 L 789 608 L 788 609 L 787 608 L 785 608 L 783 606 L 783 600 L 784 599 L 1023 599 L 1023 592 L 576 592 L 575 591 L 575 584 L 576 583 L 1023 583 L 1023 576 L 880 576 L 879 575 L 879 568 L 736 568 L 735 567 L 735 560 L 736 559 L 1023 559 L 1023 544 L 592 544 L 591 543 L 591 536 L 592 535 L 1023 535 L 1023 528 L 912 528 L 911 527 L 911 520 L 592 520 L 591 519 L 591 512 L 592 511 L 1023 511 L 1023 504 L 616 504 L 615 503 L 615 488 L 616 487 L 1023 487 L 1023 480 L 640 480 L 639 479 L 639 472 L 600 472 L 599 471 L 599 464 L 600 463 L 1023 463 L 1023 456 L 904 456 L 903 455 L 903 448 L 632 448 L 631 447 L 631 440 L 632 439 L 1023 439 L 1023 432 L 808 432 L 807 431 L 807 424 L 696 424 L 695 423 L 695 416 L 696 415 L 1023 415 L 1023 408 L 1008 408 L 1007 407 L 1007 400 L 616 400 L 615 399 L 615 392 L 616 391 L 1023 391 L 1023 384 L 656 384 L 655 383 L 655 376 L 632 376 L 631 375 L 631 368 L 632 367 L 1023 367 L 1023 360 L 624 360 L 623 359 L 623 353 L 622 353 L 621 352 L 622 351 L 625 351 L 626 350 L 627 351 L 639 351 L 639 346 L 638 346 L 637 345 L 638 344 L 639 344 L 640 343 L 641 343 L 642 342 L 643 343 L 647 343 L 648 344 L 648 351 L 895 351 L 895 344 L 896 343 L 1023 343 L 1023 328 L 688 328 L 687 327 L 687 320 L 688 319 L 879 319 L 879 312 L 880 311 L 975 311 L 975 304 L 736 304 L 735 303 L 735 296 L 736 295 L 1023 295 L 1023 280 L 760 280 L 759 279 L 759 272 L 760 271 L 1023 271 L 1023 264 L 704 264 L 703 263 L 703 262 L 702 261 L 702 258 L 703 257 L 703 235 L 702 234 L 702 231 L 703 230 L 703 216 L 698 216 L 697 217 L 696 216 L 696 215 L 694 213 L 695 212 L 695 202 L 688 202 L 687 201 L 686 201 L 685 200 L 681 200 L 680 201 L 679 201 L 678 200 L 679 199 L 679 192 Z " fill="black"/>
</symbol>
  <symbol id="icon-detritus" viewBox="0 0 100 100">
    <circle cx="30" cy="30" r="5" fill="red"/>
    <circle cx="70" cy="70" r="5" fill="red"/>
    <circle cx="50" cy="50" r="5" fill="red"/>
  </symbol>
  <symbol id="icon-algae" viewBox="0 0 100 100">
    <path d="M50,90 Q55,60 50,30 Q45,10 50,10" stroke="red" stroke-width="10" fill="none"/>
  </symbol>
</svg>
</head>
<body>
<div id="toolbar">
  <label><input id="toggleLabel" type="checkbox"/> 和名表示</label>
</div>
<div id="cy"></div>
<div id="overlay-icons"></div>
<div class="info-box" id="infoBox"></div>
<script>
  const speciesInfo = {
    "Thermophilic Nematoda": {
      label_ja: "高温性線虫",
      label_en: "Thermophilic Nematoda",
      description: "高温環境に適応した線形動物で、細菌などを捕食する。",
      link: "https://www.nps.gov/yell/learn/nature/thermophilic-bacteria.htm"
    },
    "Naegleria fowleri": {
      label_ja: "ネグレリア",
      label_en: "Naegleria fowleri",
      description: "高温の淡水に生息するアメーバで、細菌を捕食する。稀に人に感染し、致命的な脳炎を引き起こす。",
      link: "https://www.cdc.gov/naegleria/about/index.html"
    },
    "Acanthamoeba castellanii": {
      label_ja: "アカントアメーバ",
      label_en: "Acanthamoeba castellanii",
      description: "自由生活性のアメーバで、細菌を捕食する。稀に人に感染し、角膜炎や脳炎を引き起こす。",
      link: "https://pmc.ncbi.nlm.nih.gov/articles/PMC3284432/"
    },
    "Bodo thermophilus": {
      label_ja: "ボド・テルモフィルス",
      label_en: "Bodo thermophilus",
      description: "高温環境に生息する鞭毛虫で、細菌を捕食する。",
      link: "https://www.nps.gov/hosp/learn/thermophiles.htm"
    }
  };

  function placeIcons(cy) {
    const overlay = document.getElementById('overlay-icons');
    overlay.innerHTML = '';
    const iconMap = {
      'Thermophilic Nematoda': 'icon-nematode',
      'Naegleria fowleri': 'icon-protozoa',
      'Acanthamoeba castellanii': 'icon-protozoa',
      'Bodo thermophilus': 'icon-protozoa',
      'Rotaria rotatoria': 'icon-cladocera',
      'Thermocyclops crassus': 'icon-protozoa',
      'Protozoa': 'icon-protozoa',
      'Bacteria spp.': 'icon-coccus',
      'Yeast-like cells': 'icon-yeast',
      'Detritus': 'icon-detritus',
      'Algae debris': 'icon-algae'
    };
    cy.nodes().forEach(node => {
      const pos = node.renderedPosition();
      const id = node.id();
      const iconId = iconMap[id];
      if (!iconId) return;
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", 40);
      svg.setAttribute("height", 40);
      svg.setAttribute("style", "position:absolute; left:" + (pos.x - 20) + "px; top:" + (pos.y - 20) + "px;");
      const use = document.createElementNS("http://www.w3.org/2000/svg", "use");
      use.setAttributeNS("http://www.w3.org/1999/xlink", "xlink:href", "#" + iconId);
      svg.appendChild(use);
      overlay.appendChild(svg);
    });
  }

  fetch("volcanic_hotspring_foodweb.json")
    .then(res => res.json())
    .then(elements => {
      const cy = cytoscape({
        container: document.getElementById('cy'),
        elements: elements,
        style: [
          {
            selector: 'node',
            style: {
              'label': 'data(label)',
              'text-valign': 'center',
              'color': '#000',
              'background-color': '#fff',
              'width': 40,
              'height': 40,
              'font-size': 10
            }
          },
          {
            selector: 'edge',
            style: {
              'width': 2,
              'line-color': '#999',
              'target-arrow-color': '#333',
              'target-arrow-shape': 'triangle',
              'curve-style': 'bezier'
            }
          }
        ],
        layout: { name: 'cose', padding: 10 }
      });

      document.getElementById('toggleLabel').addEventListener('change', (e) => {
        const showJapanese = e.target.checked;
        cy.nodes().forEach(node => {
          const info = speciesInfo[node.id()];
          if (info) {
            node.data('label', showJapanese ? info.label_ja : info.label_en);
          }
        });
      });

      cy.on('render zoom pan', () => placeIcons(cy));
      placeIcons(cy);

      cy.on('tap', 'node', evt => {
        const node = evt.target;
        const info = speciesInfo[node.id()];
        if (info) {
          const box = document.getElementById('infoBox');
          box.innerHTML = `<strong>${info.label_ja} / ${info.label_en}</strong><br>${info.description}<br><a href="${info.link}" target="_blank">出典</a>`;
          box.style.display = 'block';
        }
      });

      cy.on('tap', event => {
        if (event.target === cy) {
          document.getElementById('infoBox').style.display = 'none';
        }
      });
    });
</script>
</body>
</html>
